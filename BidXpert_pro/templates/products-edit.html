{% extends 'master.html' %}
{% load static %}
{% block content %}

<main id="main" class="main">
  <div class="pagetitle">
    <h1>Edit Product</h1>
    <nav>
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Home</a></li>
        <li class="breadcrumb-item active">Edit Product</li>
      </ol>
    </nav>
  </div>

  <section class="section">
    <div class="row">
      <div class="col-lg-12">
        <div class="card" style="background-color: #fff; border: 1px solid #d4af37;">
          <div class="card-body">
            <h5 class="card-title" style="color: #d4af37;">Edit Product</h5>

            {% if form.errors %}
              <div class="alert alert-danger">
                {{ form.errors }}
              </div>
            {% endif %}

            <form method="post" enctype="multipart/form-data">
              {% csrf_token %}

              <!-- Show Existing Images with Delete Option -->
              <div class="row mb-3">
                <label class="col-sm-2 col-form-label" style="color: #d4af37;">Existing Images</label>
                <div class="col-sm-10 d-flex flex-wrap gap-3">
                  {% for img in data.images.all %}
                    <div class="position-relative" style="display:inline-block;">
                      <img src="{{ img.image.url }}" width="100" height="100" class="border rounded">
                      <a href="{% url 'delete_product_image' img.id %}" onclick="return confirm('Are you sure you want to delete this image?')" class="position-absolute top-0 end-0 text-danger" style="text-decoration: none; font-size: 1.2rem;">
                        &times;
                      </a>
                    </div>
                  {% empty %}
                    <p>No images uploaded.</p>
                  {% endfor %}
                </div>
              </div>

              <!-- Upload New Images -->
              <div class="row mb-3">
                <label class="col-sm-2 col-form-label" style="color: #d4af37;">Add More Images</label>
                <div class="col-sm-10">
                  <input type="file" name="images" class="form-control" multiple>
                </div>
              </div>

              <!-- Category -->
              <div class="row mb-3">
                <label class="col-sm-2 col-form-label" style="color: #d4af37;">Category</label>
                <div class="col-sm-10">
                  <select name="category" class="form-control" style="border-color: #d4af37;">
                    {% for cat in cate %}
                      <option value="{{ cat.id }}" {% if data.category.id == cat.id %}selected{% endif %}>
                        {{ cat.category }}
                      </option>
                    {% endfor %}
                  </select>
                </div>
              </div>

              <!-- Product Name -->
              <div class="row mb-3">
                <label class="col-sm-2 col-form-label" style="color: #d4af37;">Product Name</label>
                <div class="col-sm-10">
                  <input type="text" name="product" value="{{ data.product }}" class="form-control" style="border-color: #d4af37;" required>
                </div>
              </div>

              <!-- Other Info -->
              <div class="mb-3">
                <label class="form-label" style="color: #d4af37;">Other Information</label>
                <textarea class="form-control" name="other_information" rows="3" style="border-color: #d4af37;">{{ data.other_information }}</textarea>
              </div>

              <!-- Extra Fields -->
              <div class="row mb-3">
                <label class="col-sm-2 col-form-label" style="color: #d4af37;">Date</label>
                <div class="col-sm-10">
                  <input type="date" name="date" value="{{ data.extra_fields.date }}" class="form-control" style="border-color: #d4af37;">
                </div>
              </div>

              <div class="row mb-3">
                <label class="col-sm-2 col-form-label" style="color: #d4af37;">Time</label>
                <div class="col-sm-10">
                  <input type="time" name="time" value="{{ data.extra_fields.time }}" class="form-control" style="border-color: #d4af37;">
                </div>
              </div>

              <div class="row mb-3">
                <label class="col-sm-2 col-form-label" style="color: #d4af37;">Amount</label>
                <div class="col-sm-10">
                  <input type="number" name="amount" value="{{ data.extra_fields.amount }}" class="form-control" style="border-color: #d4af37;">
                </div>
              </div>

              <div class="row mb-3">
                <label class="col-sm-2 col-form-label" style="color: #d4af37;">Starting Price</label>
                <div class="col-sm-10">
                  <input type="number" name="starting_price" value="{{ data.extra_fields.starting_price }}" class="form-control" style="border-color: #d4af37;">
                </div>
              </div>

              <!-- End Date -->
              <div class="row mb-3">
                <label class="col-sm-2 col-form-label" style="color: #d4af37;">End Date</label>
                <div class="col-sm-10">
                  <input type="datetime-local" name="end_date" value="{{ data.end_date|date:'Y-m-d\\TH:i' }}" class="form-control" style="border-color: #d4af37;">
                </div>
              </div>

              <div>
                <button type="submit" class="btn btn-primary" style="background-color: #d4af37; border-color: #d4af37; color: #fff;">Update Product</button>
              </div>

            </form>

          </div>
        </div>
      </div>
    </div>
  </section>
</main>

{% endblock %}
