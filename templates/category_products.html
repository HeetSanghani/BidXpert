{% extends 'master1.html' %}
{% load static %}
{% block content %}

<main id="main" class="main">

<div class="text-center py-6">
  <h2 class="text-3xl font-bold text-yellow-400">
    Products in {{ category.category }}
  </h2>
</div>

</main>

<section class="section">
  <div class="container-fluid" style="max-width: 1280px; margin: auto;">
    <div class="row">
      {% for pd in products %}
      <div class="col-12 col-sm-6 col-md-4 col-lg-4 mb-8">
        <div class="card shadow-lg border-0 h-100 bg-dark product-card transition-all duration-300 transform hover:scale-105 hover:shadow-2xl">
          <div class="card-body d-flex flex-column">

            <!-- Carousel for Multiple Images -->
            <div class="image-container mb-4">
              {% if pd.images.all %}
              <div id="carousel{{ pd.id }}" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-inner">
                  {% for img in pd.images.all %}
                  <div class="carousel-item {% if forloop.first %}active{% endif %}">
                    <div class="standard-image-box">
                      <img src="{{ img.image.url }}" class="product-image w-full h-48 object-cover rounded-lg transition-transform duration-300 hover:scale-105">
                    </div>
                  </div>
                  {% endfor %}
                </div>
                {% if pd.images.all|length > 1 %}
                <button class="carousel-control-prev" type="button" data-bs-target="#carousel{{ pd.id }}" data-bs-slide="prev">
                  <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                  <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carousel{{ pd.id }}" data-bs-slide="next">
                  <span class="carousel-control-next-icon" aria-hidden="true"></span>
                  <span class="visually-hidden">Next</span>
                </button>
                {% endif %}
              </div>
              {% else %}
              <div class="no-image bg-gray-200 text-center p-4 rounded-lg">
                No Image
              </div>
              {% endif %}
            </div>

            <div class="bg-yellow-500 product-info flex-grow-1 p-4">
              <div class="category-badge mb-4">
                <span class="badge bg-light text-dark p-3 rounded-pill">{{ pd.category }}</span>
              </div>

              <h5 class="product-title text-lg font-bold text-black mb-3 text-truncate">{{ pd.product }}</h5>

              <div class="product-description mb-4">
                <p class="text-dark small">{{ pd.other_information|default:"No additional information" }}</p>
              </div>

              <div class="price-info mb-4">
                <p class="fw-bold text-success mb-2">Normal Price: ₹{{ pd.amount|default:"N/A" }}</p>
                <h5 class="fw-bold text-danger">Starting Price: ₹{{ pd.starting_price|default:"N/A" }}</h5>
              </div>

              <p class="auction-date small text-dark">
                <i class="fas fa-calendar-alt me-2"></i> {{ pd.date|default:"N/A" }} at {{ pd.time|default:"N/A" }}
              </p>
            </div>

            <br>
            <div class="mt-auto text-center">
              {% if user.is_authenticated %}
              
              <a href="{% url 'bid_view' product_id=pd.id %}" class="btn btn-primary advanced-bid-btn w-full py-2 rounded-lg text-white transition-colors duration-300 bg-black hover:bg-black border-2 border-blue-500">
  Place a Bid
</a>

              {% else %}
              <button onclick="showLoginModal()" class="btn btn-primary advanced-bid-btn w-full py-2 rounded-lg text-white transition-colors duration-300 bg-black hover:bg-black border-2 border-blue-500">
                View & Bid
              </button>
              {% endif %}
            </div>

          </div>
        </div>
      </div>
      {% empty %}
      <div class="text-center w-100 p-5">
        <div class="alert alert-info">
          <i class="fas fa-info-circle me-2"></i> No products available at this time.
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</section>

<!-- Login Modal (copied and matched design from original page) -->
<div id="loginModal" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex justify-center items-center z-50 hidden">
  <div class="bg-white p-8 rounded-lg shadow-xl max-w-sm w-full text-center">
    <h3 class="text-2xl font-bold text-gray-800 mb-4">Login Required</h3>
    <p class="text-gray-600 mb-6">Please login in or register to view and place bids on products.</p>

    <div class="flex justify-center gap-4">
      <a href="{% url 'login' %}" class="btn btn-success px-6 py-2 text-yellow bg-black rounded-md hover:bg-blue-700 border-black transition-all">Login</a>
      <a href="{% url 'register' %}" class="btn btn-info px-6 py-2 text-white bg-green-600 rounded-md hover:bg-green-600 border-black transition-all">Register</a>
    </div>

    <button onclick="hideLoginModal()" class="mt-4 text-gray-600 hover:text-gray-800">Cancel</button>
  </div>
</div>

<script>
  function showLoginModal() {
    document.getElementById('loginModal').classList.remove('hidden');
  }

  function hideLoginModal() {
    document.getElementById('loginModal').classList.add('hidden');
  }
</script>

{% endblock %}

<!-- Custom Styling -->
<style>
  body {
    background-color: black;
    color: #212529;
  }

  .product-card {
    border-radius: 10px;
    transition: all 0.3s ease;
    overflow: hidden;
  }

  .product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
  }

  .image-container {
    height: 200px;
    overflow: hidden;
    border-radius: 8px;
    background: #000000;
  }

  .standard-image-box {
    width: 100%;
    height: 200px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #000000;
    border-radius: 8px;
  }

  .product-image {
    width: 180px;
    height: 180px;
    object-fit: contain;
  }

  .no-image {
    width: 100%;
    height: 200px;
    background: red;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    color: #6c757d;
    border-radius: 8px;
  }

  .product-title {
    font-size: 18px;
    line-height: 1.3;
    height: 24px;
    overflow: hidden;
  }

  .advanced-bid-btn {
    padding: 10px 20px;
    font-weight: 600;
    border-radius: 30px;
    transition: all 0.3s ease;
    border: none;
  }

  .advanced-bid-btn:hover {
    transform: translateY(-2px);
  }

  .auction-date {
    font-size: 13px;
  }

  /* Modal Styling */
  #loginModal {
    background-color: rgba(0, 0, 0, 0.6);
  }

  #loginModal .bg-white {
    background-color: white;
    color: black;
  }

  #loginModal h3 {
    color: black;
  }

  #loginModal .btn {
    font-weight: 600;
    border-radius: 30px;
  }

  #loginModal .btn:hover {
    background-color: black;
    transform: translateY(-2px);
  }
</style>
